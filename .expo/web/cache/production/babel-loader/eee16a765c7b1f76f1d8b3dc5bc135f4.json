{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useEffect,useState,useRef}from\"react\";import Loadable from\"@loadable/component\";import firebase from\"gatsby-plugin-firebase\";import{useAuthState}from\"react-firebase-hooks/auth\";import*as handpose from\"@tensorflow-models/handpose\";import*as facemesh from\"@tensorflow-models/facemesh\";import{makeStyles}from\"@material-ui/core/styles\";import{Container,Box,Typography,Button,Card,CardContent,CardHeader,IconButton,List,ListItem,ListItemSecondaryAction,ListItemText,ListItemAvatar,Avatar}from\"@material-ui/core\";import IndefiniteLoading from\"src/components/loading/indefiniteLoading\";var UsersList=Loadable(function(){return import(\"./UsersList\");},{fallback:React.createElement(IndefiniteLoading,{message:\"UsersList\"})});var RoomDialog=Loadable(function(){return import(\"./RoomDialog\");},{fallback:React.createElement(IndefiniteLoading,{message:\"RoomDialog\"})});var VideoStream=Loadable(function(){return import(\"./VideoStream\");},{fallback:React.createElement(IndefiniteLoading,{message:\"VideoStream\"})});var useStyles=makeStyles(function(theme){return{root:{}};});var WebRTC=function WebRTC(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),remoteVideoStream=_useState2[0],setRemoteVideoStream=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),localVideoStream=_useState4[0],setLocalVideoStream=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),open=_useState6[0],setOpen=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isCalling=_useState8[0],setIsCalling=_useState8[1];var faceVideoRef=useRef();var observeWithFacemesh=function observeWithFacemesh(){var model,faces;return _regeneratorRuntime.async(function observeWithFacemesh$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(facemesh.load());case 2:model=_context.sent;_context.next=5;return _regeneratorRuntime.awrap(model.estimateFaces(faceVideoRef));case 5:faces=_context.sent;faces.forEach(function(face){return console.log(face.scaledMesh);});case 7:case\"end\":return _context.stop();}}},null,null,null,Promise);};useEffect(function(){return function(){if(!localVideoStream){return;}console.log(\"Cleaning up stream.\",localVideoStream);var tracks=localVideoStream.getTracks();tracks.forEach(function(track){track.stop();});};},[localVideoStream]);var initCall=function initCall(doc){var data,inputSteam;return _regeneratorRuntime.async(function initCall$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setOpen(true);data=doc.data();console.log(\"data\",data);_context2.next=5;return _regeneratorRuntime.awrap(getMediaStream());case 5:inputSteam=_context2.sent;console.log(\"inputSteam\",inputSteam);case 7:case\"end\":return _context2.stop();}}},null,null,null,Promise);};var getMediaStream=function getMediaStream(){var mediaStream;return _regeneratorRuntime.async(function getMediaStream$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return _regeneratorRuntime.awrap(navigator.mediaDevices.getUserMedia({video:true}));case 3:mediaStream=_context3.sent;setLocalVideoStream(mediaStream);return _context3.abrupt(\"return\",mediaStream);case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.error(_context3.t0);case 11:case\"end\":return _context3.stop();}}},null,null,[[0,8]],Promise);};var cleanupMediaStream=function cleanupMediaStream(){if(!localVideoStream){return;}console.log(\"Cleaning up stream.\",localVideoStream);var tracks=localVideoStream.getTracks();tracks.forEach(function(track){track.stop();});};var handleClose=function handleClose(){cleanupMediaStream();setOpen(false);};return React.createElement(React.Fragment,null,React.createElement(UsersList,{callUser:initCall}),isCalling&&React.createElement(IndefiniteLoading,{message:\"isCalling\"}),React.createElement(RoomDialog,{handleClose:handleClose,open:open},React.createElement(VideoStream,{muted:true,stream:localVideoStream})));};export default WebRTC;","map":{"version":3,"sources":["C:/Users/arnol/code/entroprise/src/components/UsersPage/WebRTC.js"],"names":["React","useEffect","useState","useRef","Loadable","firebase","useAuthState","handpose","facemesh","makeStyles","Container","Box","Typography","Button","Card","CardContent","CardHeader","IconButton","List","ListItem","ListItemSecondaryAction","ListItemText","ListItemAvatar","Avatar","IndefiniteLoading","UsersList","fallback","RoomDialog","VideoStream","useStyles","theme","root","WebRTC","remoteVideoStream","setRemoteVideoStream","localVideoStream","setLocalVideoStream","open","setOpen","isCalling","setIsCalling","faceVideoRef","observeWithFacemesh","load","model","estimateFaces","faces","forEach","face","console","log","scaledMesh","tracks","getTracks","track","stop","initCall","doc","data","getMediaStream","inputSteam","navigator","mediaDevices","getUserMedia","video","mediaStream","error","cleanupMediaStream","handleClose"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\"\r\nimport Loadable from \"@loadable/component\"\r\n\r\nimport firebase from \"gatsby-plugin-firebase\"\r\nimport { useAuthState } from \"react-firebase-hooks/auth\"\r\nimport * as handpose from \"@tensorflow-models/handpose\"\r\nimport * as facemesh from \"@tensorflow-models/facemesh\"\r\n\r\nimport { makeStyles } from \"@material-ui/core/styles\"\r\nimport {\r\n  Container,\r\n  Box,\r\n  Typography,\r\n  Button,\r\n  Card,\r\n  CardContent,\r\n  CardHeader,\r\n  IconButton,\r\n  List,\r\n  ListItem,\r\n  ListItemSecondaryAction,\r\n  ListItemText,\r\n  ListItemAvatar,\r\n  Avatar,\r\n} from \"@material-ui/core\"\r\n\r\nimport IndefiniteLoading from \"src/components/loading/indefiniteLoading\"\r\n\r\nconst UsersList = Loadable(() => import(\"./UsersList\"), {\r\n  fallback: <IndefiniteLoading message=\"UsersList\" />,\r\n})\r\n\r\nconst RoomDialog = Loadable(() => import(\"./RoomDialog\"), {\r\n  fallback: <IndefiniteLoading message=\"RoomDialog\" />,\r\n})\r\n\r\nconst VideoStream = Loadable(() => import(\"./VideoStream\"), {\r\n  fallback: <IndefiniteLoading message=\"VideoStream\" />,\r\n})\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n  root: {},\r\n}))\r\n\r\nconst WebRTC = () => {\r\n  const [remoteVideoStream, setRemoteVideoStream] = useState(null)\r\n  const [localVideoStream, setLocalVideoStream] = useState(null)\r\n\r\n  const [open, setOpen] = useState(false)\r\n  const [isCalling, setIsCalling] = useState(false)\r\n\r\n  const faceVideoRef = useRef()\r\n\r\n  const observeWithFacemesh = async () => {\r\n    // Load the MediaPipe facemesh model assets.\r\n    const model = await facemesh.load()\r\n\r\n    // Pass in a video stream to the model to obtain\r\n    // an array of detected faces from the MediaPipe graph.\r\n    const faces = await model.estimateFaces(faceVideoRef)\r\n\r\n    // Each face object contains a `scaledMesh` property,\r\n    // which is an array of 468 landmarks.\r\n    faces.forEach(face => console.log(face.scaledMesh))\r\n  }\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (!localVideoStream) {\r\n        return\r\n      }\r\n      console.log(\"Cleaning up stream.\", localVideoStream)\r\n      const tracks = localVideoStream.getTracks()\r\n      tracks.forEach(track => {\r\n        track.stop()\r\n      })\r\n    }\r\n  }, [localVideoStream])\r\n\r\n  const initCall = async doc => {\r\n    setOpen(true)\r\n    const data = doc.data()\r\n    console.log(\"data\", data)\r\n\r\n    const inputSteam = await getMediaStream()\r\n    console.log(\"inputSteam\", inputSteam)\r\n\r\n    // const facemeshData = observeWithFacemesh(localVideoStream)\r\n    // console.log(\"facemeshData\", facemeshData)\r\n  }\r\n\r\n  const getMediaStream = async () => {\r\n    try {\r\n      const mediaStream = await navigator.mediaDevices.getUserMedia({\r\n        // audio: true,\r\n        video: true,\r\n      })\r\n      setLocalVideoStream(mediaStream)\r\n      return mediaStream\r\n    } catch (error) {\r\n      console.error(error)\r\n    }\r\n  }\r\n\r\n  const cleanupMediaStream = () => {\r\n    if (!localVideoStream) {\r\n      return\r\n    }\r\n    console.log(\"Cleaning up stream.\", localVideoStream)\r\n    const tracks = localVideoStream.getTracks()\r\n    tracks.forEach(track => {\r\n      track.stop()\r\n    })\r\n  }\r\n\r\n  const handleClose = () => {\r\n    cleanupMediaStream()\r\n    setOpen(false)\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <UsersList callUser={initCall} />\r\n      {isCalling && <IndefiniteLoading message=\"isCalling\" />}\r\n      <RoomDialog handleClose={handleClose} open={open}>\r\n        <VideoStream muted={true} stream={localVideoStream} />\r\n      </RoomDialog>\r\n    </>\r\n  )\r\n}\r\nexport default WebRTC\r\n"]},"metadata":{},"sourceType":"module"}