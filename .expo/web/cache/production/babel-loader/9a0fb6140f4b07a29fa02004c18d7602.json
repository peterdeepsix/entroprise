{"ast":null,"code":"import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _get from\"@babel/runtime/helpers/get\";import _inherits from\"@babel/runtime/helpers/inherits\";import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _extends from\"@babel/runtime/helpers/extends\";import prefetchHelper from\"./prefetch\";import emitter from\"./emitter\";import{setMatchPaths,findPath,findMatchPath as _findMatchPath}from\"./find-path\";export var PageResourceStatus={Error:\"error\",Success:\"success\"};var preferDefault=function preferDefault(m){return m&&m.default||m;};var stripSurroundingSlashes=function stripSurroundingSlashes(s){s=s[0]===\"/\"?s.slice(1):s;s=s.endsWith(\"/\")?s.slice(0,-1):s;return s;};var createPageDataUrl=function createPageDataUrl(path){var fixedPath=path===\"/\"?\"index\":stripSurroundingSlashes(path);return __PATH_PREFIX__+\"/page-data/\"+fixedPath+\"/page-data.json\";};var doFetch=function doFetch(url){var method=arguments.length>1&&arguments[1]!==undefined?arguments[1]:\"GET\";return new Promise(function(resolve,reject){var req=new XMLHttpRequest();req.open(method,url,true);req.onreadystatechange=function(){if(req.readyState==4){resolve(req);}};req.send(null);});};var _loadPageDataJson=function loadPageDataJson(loadObj){var pagePath=loadObj.pagePath,_loadObj$retries=loadObj.retries,retries=_loadObj$retries===void 0?0:_loadObj$retries;var url=createPageDataUrl(pagePath);return doFetch(url).then(function(req){var status=req.status,responseText=req.responseText;if(status===200){try{var jsonPayload=JSON.parse(responseText);if(jsonPayload.path===undefined){throw new Error(\"not a valid pageData response\");}return _extends(loadObj,{status:PageResourceStatus.Success,payload:jsonPayload});}catch(err){}}if(status===404||status===200){if(pagePath===\"/404.html\"){return _extends(loadObj,{status:PageResourceStatus.Error});}return _loadPageDataJson(_extends(loadObj,{pagePath:\"/404.html\",notFound:true}));}if(status===500){return _extends(loadObj,{status:PageResourceStatus.Error});}if(retries<3){return _loadPageDataJson(_extends(loadObj,{retries:retries+1}));}return _extends(loadObj,{status:PageResourceStatus.Error});});};var doesConnectionSupportPrefetch=function doesConnectionSupportPrefetch(){if(\"connection\"in navigator&&typeof navigator.connection!==\"undefined\"){if((navigator.connection.effectiveType||\"\").includes(\"2g\")){return false;}if(navigator.connection.saveData){return false;}}return true;};var toPageResources=function toPageResources(pageData){var component=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var page={componentChunkName:pageData.componentChunkName,path:pageData.path,webpackCompilationHash:pageData.webpackCompilationHash,matchPath:pageData.matchPath};return{component:component,json:pageData.result,page:page};};export var BaseLoader=function(){function BaseLoader(loadComponent,matchPaths){_classCallCheck(this,BaseLoader);this.pageDb=new Map();this.inFlightDb=new Map();this.pageDataDb=new Map();this.prefetchTriggered=new Set();this.prefetchCompleted=new Set();this.loadComponent=loadComponent;setMatchPaths(matchPaths);}_createClass(BaseLoader,[{key:\"setApiRunner\",value:function setApiRunner(apiRunner){this.apiRunner=apiRunner;this.prefetchDisabled=apiRunner(\"disableCorePrefetching\").some(function(a){return a;});}},{key:\"loadPageDataJson\",value:function loadPageDataJson(rawPath){var _this=this;var pagePath=findPath(rawPath);if(this.pageDataDb.has(pagePath)){return Promise.resolve(this.pageDataDb.get(pagePath));}return _loadPageDataJson({pagePath:pagePath}).then(function(pageData){_this.pageDataDb.set(pagePath,pageData);return pageData;});}},{key:\"findMatchPath\",value:function findMatchPath(rawPath){return _findMatchPath(rawPath);}},{key:\"loadPage\",value:function loadPage(rawPath){var _this2=this;var pagePath=findPath(rawPath);if(this.pageDb.has(pagePath)){var page=this.pageDb.get(pagePath);return Promise.resolve(page.payload);}if(this.inFlightDb.has(pagePath)){return this.inFlightDb.get(pagePath);}var inFlight=Promise.all([this.loadAppData(),this.loadPageDataJson(pagePath)]).then(function(allData){var result=allData[1];if(result.status===PageResourceStatus.Error){return{status:PageResourceStatus.Error};}var pageData=result.payload;var _pageData=pageData,componentChunkName=_pageData.componentChunkName;return _this2.loadComponent(componentChunkName).then(function(component){var finalResult={createdAt:new Date()};var pageResources;if(!component){finalResult.status=PageResourceStatus.Error;}else{finalResult.status=PageResourceStatus.Success;if(result.notFound===true){finalResult.notFound=true;}pageData=_extends(pageData,{webpackCompilationHash:allData[0]?allData[0].webpackCompilationHash:\"\"});pageResources=toPageResources(pageData,component);finalResult.payload=pageResources;emitter.emit(\"onPostLoadPageResources\",{page:pageResources,pageResources:pageResources});}_this2.pageDb.set(pagePath,finalResult);return pageResources;});}).then(function(response){_this2.inFlightDb.delete(pagePath);return response;}).catch(function(err){_this2.inFlightDb.delete(pagePath);throw err;});this.inFlightDb.set(pagePath,inFlight);return inFlight;}},{key:\"loadPageSync\",value:function loadPageSync(rawPath){var pagePath=findPath(rawPath);if(this.pageDb.has(pagePath)){return this.pageDb.get(pagePath).payload;}return undefined;}},{key:\"shouldPrefetch\",value:function shouldPrefetch(pagePath){if(!doesConnectionSupportPrefetch()){return false;}if(this.pageDb.has(pagePath)){return false;}return true;}},{key:\"prefetch\",value:function prefetch(pagePath){var _this3=this;if(!this.shouldPrefetch(pagePath)){return false;}if(!this.prefetchTriggered.has(pagePath)){this.apiRunner(\"onPrefetchPathname\",{pathname:pagePath});this.prefetchTriggered.add(pagePath);}if(this.prefetchDisabled){return false;}var realPath=findPath(pagePath);this.doPrefetch(realPath).then(function(){if(!_this3.prefetchCompleted.has(pagePath)){_this3.apiRunner(\"onPostPrefetchPathname\",{pathname:pagePath});_this3.prefetchCompleted.add(pagePath);}});return true;}},{key:\"doPrefetch\",value:function doPrefetch(pagePath){throw new Error(\"doPrefetch not implemented\");}},{key:\"hovering\",value:function hovering(rawPath){this.loadPage(rawPath);}},{key:\"getResourceURLsForPathname\",value:function getResourceURLsForPathname(rawPath){var pagePath=findPath(rawPath);var page=this.pageDataDb.get(pagePath);if(page){var pageResources=toPageResources(page.payload);return[].concat(_toConsumableArray(createComponentUrls(pageResources.page.componentChunkName)),[createPageDataUrl(pagePath)]);}else{return null;}}},{key:\"isPageNotFound\",value:function isPageNotFound(rawPath){var pagePath=findPath(rawPath);var page=this.pageDb.get(pagePath);return page&&page.notFound===true;}},{key:\"loadAppData\",value:function loadAppData(){var _this4=this;var retries=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return doFetch(__PATH_PREFIX__+\"/page-data/app-data.json\").then(function(req){var status=req.status,responseText=req.responseText;var appData;if(status!==200&&retries<3){return _this4.loadAppData(retries+1);}if(status===200){try{var jsonPayload=JSON.parse(responseText);if(jsonPayload.webpackCompilationHash===undefined){throw new Error(\"not a valid app-data response\");}appData=jsonPayload;}catch(err){}}return appData;});}}]);return BaseLoader;}();var createComponentUrls=function createComponentUrls(componentChunkName){return(window.___chunkMapping[componentChunkName]||[]).map(function(chunk){return __PATH_PREFIX__+chunk;});};export var ProdLoader=function(_BaseLoader){_inherits(ProdLoader,_BaseLoader);function ProdLoader(asyncRequires,matchPaths){_classCallCheck(this,ProdLoader);var loadComponent=function loadComponent(chunkName){return asyncRequires.components[chunkName]?asyncRequires.components[chunkName]().then(preferDefault).catch(function(){return null;}):Promise.resolve();};return _possibleConstructorReturn(this,_getPrototypeOf(ProdLoader).call(this,loadComponent,matchPaths));}_createClass(ProdLoader,[{key:\"doPrefetch\",value:function doPrefetch(pagePath){var _this5=this;var pageDataUrl=createPageDataUrl(pagePath);return prefetchHelper(pageDataUrl,{crossOrigin:\"anonymous\",as:\"fetch\"}).then(function(){return _this5.loadPageDataJson(pagePath);}).then(function(result){if(result.status!==PageResourceStatus.Success){return Promise.resolve();}var pageData=result.payload;var chunkName=pageData.componentChunkName;var componentUrls=createComponentUrls(chunkName);return Promise.all(componentUrls.map(prefetchHelper)).then(function(){return pageData;});});}},{key:\"loadPageDataJson\",value:function loadPageDataJson(rawPath){return _get(_getPrototypeOf(ProdLoader.prototype),\"loadPageDataJson\",this).call(this,rawPath).then(function(data){if(data.notFound){return doFetch(rawPath,\"HEAD\").then(function(req){if(req.status===200){return{status:PageResourceStatus.Error};}return data;});}return data;});}}]);return ProdLoader;}(BaseLoader);var instance;export var setLoader=function setLoader(_loader){instance=_loader;};export var publicLoader={getResourcesForPathname:function getResourcesForPathname(rawPath){console.warn(\"Warning: getResourcesForPathname is deprecated. Use loadPage instead\");return instance.i.loadPage(rawPath);},getResourcesForPathnameSync:function getResourcesForPathnameSync(rawPath){console.warn(\"Warning: getResourcesForPathnameSync is deprecated. Use loadPageSync instead\");return instance.i.loadPageSync(rawPath);},enqueue:function enqueue(rawPath){return instance.prefetch(rawPath);},getResourceURLsForPathname:function getResourceURLsForPathname(rawPath){return instance.getResourceURLsForPathname(rawPath);},loadPage:function loadPage(rawPath){return instance.loadPage(rawPath);},loadPageSync:function loadPageSync(rawPath){return instance.loadPageSync(rawPath);},prefetch:function prefetch(rawPath){return instance.prefetch(rawPath);},isPageNotFound:function isPageNotFound(rawPath){return instance.isPageNotFound(rawPath);},hovering:function hovering(rawPath){return instance.hovering(rawPath);},loadAppData:function loadAppData(){return instance.loadAppData();}};export default publicLoader;","map":{"version":3,"sources":["C:/Users/arnol/code/entroprise/.cache/loader.js"],"names":["prefetchHelper","emitter","setMatchPaths","findPath","findMatchPath","PageResourceStatus","Error","Success","preferDefault","m","default","stripSurroundingSlashes","s","slice","endsWith","createPageDataUrl","path","fixedPath","__PATH_PREFIX__","doFetch","url","method","Promise","resolve","reject","req","XMLHttpRequest","open","onreadystatechange","readyState","send","loadPageDataJson","loadObj","pagePath","retries","then","status","responseText","jsonPayload","JSON","parse","undefined","payload","err","notFound","doesConnectionSupportPrefetch","navigator","connection","effectiveType","includes","saveData","toPageResources","pageData","component","page","componentChunkName","webpackCompilationHash","matchPath","json","result","BaseLoader","loadComponent","matchPaths","pageDb","Map","inFlightDb","pageDataDb","prefetchTriggered","Set","prefetchCompleted","apiRunner","prefetchDisabled","some","a","rawPath","has","get","set","inFlight","all","loadAppData","allData","finalResult","createdAt","Date","pageResources","emit","response","delete","catch","shouldPrefetch","pathname","add","realPath","doPrefetch","loadPage","createComponentUrls","appData","window","___chunkMapping","map","chunk","ProdLoader","asyncRequires","chunkName","components","pageDataUrl","crossOrigin","as","componentUrls","data","instance","setLoader","_loader","publicLoader","getResourcesForPathname","console","warn","i","getResourcesForPathnameSync","loadPageSync","enqueue","prefetch","getResourceURLsForPathname","isPageNotFound","hovering"],"mappings":"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","sourcesContent":["import prefetchHelper from \"./prefetch\"\nimport emitter from \"./emitter\"\nimport { setMatchPaths, findPath, findMatchPath } from \"./find-path\"\n\n/**\n * Available resource loading statuses\n */\nexport const PageResourceStatus = {\n  /**\n   * At least one of critical resources failed to load\n   */\n  Error: `error`,\n  /**\n   * Resources loaded successfully\n   */\n  Success: `success`,\n}\n\nconst preferDefault = m => (m && m.default) || m\n\nconst stripSurroundingSlashes = s => {\n  s = s[0] === `/` ? s.slice(1) : s\n  s = s.endsWith(`/`) ? s.slice(0, -1) : s\n  return s\n}\n\nconst createPageDataUrl = path => {\n  const fixedPath = path === `/` ? `index` : stripSurroundingSlashes(path)\n  return `${__PATH_PREFIX__}/page-data/${fixedPath}/page-data.json`\n}\n\nconst doFetch = (url, method = `GET`) =>\n  new Promise((resolve, reject) => {\n    const req = new XMLHttpRequest()\n    req.open(method, url, true)\n    req.onreadystatechange = () => {\n      if (req.readyState == 4) {\n        resolve(req)\n      }\n    }\n    req.send(null)\n  })\n\nconst loadPageDataJson = loadObj => {\n  const { pagePath, retries = 0 } = loadObj\n  const url = createPageDataUrl(pagePath)\n  return doFetch(url).then(req => {\n    const { status, responseText } = req\n\n    // Handle 200\n    if (status === 200) {\n      try {\n        const jsonPayload = JSON.parse(responseText)\n        if (jsonPayload.path === undefined) {\n          throw new Error(`not a valid pageData response`)\n        }\n\n        return Object.assign(loadObj, {\n          status: PageResourceStatus.Success,\n          payload: jsonPayload,\n        })\n      } catch (err) {\n        // continue regardless of error\n      }\n    }\n\n    // Handle 404\n    if (status === 404 || status === 200) {\n      // If the request was for a 404 page and it doesn't exist, we're done\n      if (pagePath === `/404.html`) {\n        return Object.assign(loadObj, {\n          status: PageResourceStatus.Error,\n        })\n      }\n\n      // Need some code here to cache the 404 request. In case\n      // multiple loadPageDataJsons result in 404s\n      return loadPageDataJson(\n        Object.assign(loadObj, { pagePath: `/404.html`, notFound: true })\n      )\n    }\n\n    // handle 500 response (Unrecoverable)\n    if (status === 500) {\n      return Object.assign(loadObj, {\n        status: PageResourceStatus.Error,\n      })\n    }\n\n    // Handle everything else, including status === 0, and 503s. Should retry\n    if (retries < 3) {\n      return loadPageDataJson(Object.assign(loadObj, { retries: retries + 1 }))\n    }\n\n    // Retried 3 times already, result is an error.\n    return Object.assign(loadObj, {\n      status: PageResourceStatus.Error,\n    })\n  })\n}\n\nconst doesConnectionSupportPrefetch = () => {\n  if (\n    `connection` in navigator &&\n    typeof navigator.connection !== `undefined`\n  ) {\n    if ((navigator.connection.effectiveType || ``).includes(`2g`)) {\n      return false\n    }\n    if (navigator.connection.saveData) {\n      return false\n    }\n  }\n  return true\n}\n\nconst toPageResources = (pageData, component = null) => {\n  const page = {\n    componentChunkName: pageData.componentChunkName,\n    path: pageData.path,\n    webpackCompilationHash: pageData.webpackCompilationHash,\n    matchPath: pageData.matchPath,\n  }\n\n  return {\n    component,\n    json: pageData.result,\n    page,\n  }\n}\n\nexport class BaseLoader {\n  constructor(loadComponent, matchPaths) {\n    // Map of pagePath -> Page. Where Page is an object with: {\n    //   status: PageResourceStatus.Success || PageResourceStatus.Error,\n    //   payload: PageResources, // undefined if PageResourceStatus.Error\n    // }\n    // PageResources is {\n    //   component,\n    //   json: pageData.result,\n    //   page: {\n    //     componentChunkName,\n    //     path,\n    //     webpackCompilationHash,\n    //   }\n    // }\n    this.pageDb = new Map()\n    this.inFlightDb = new Map()\n    this.pageDataDb = new Map()\n    this.prefetchTriggered = new Set()\n    this.prefetchCompleted = new Set()\n    this.loadComponent = loadComponent\n    setMatchPaths(matchPaths)\n  }\n\n  setApiRunner(apiRunner) {\n    this.apiRunner = apiRunner\n    this.prefetchDisabled = apiRunner(`disableCorePrefetching`).some(a => a)\n  }\n\n  loadPageDataJson(rawPath) {\n    const pagePath = findPath(rawPath)\n    if (this.pageDataDb.has(pagePath)) {\n      return Promise.resolve(this.pageDataDb.get(pagePath))\n    }\n\n    return loadPageDataJson({ pagePath }).then(pageData => {\n      this.pageDataDb.set(pagePath, pageData)\n\n      return pageData\n    })\n  }\n\n  findMatchPath(rawPath) {\n    return findMatchPath(rawPath)\n  }\n\n  // TODO check all uses of this and whether they use undefined for page resources not exist\n  loadPage(rawPath) {\n    const pagePath = findPath(rawPath)\n    if (this.pageDb.has(pagePath)) {\n      const page = this.pageDb.get(pagePath)\n      return Promise.resolve(page.payload)\n    }\n    if (this.inFlightDb.has(pagePath)) {\n      return this.inFlightDb.get(pagePath)\n    }\n\n    const inFlight = Promise.all([\n      this.loadAppData(),\n      this.loadPageDataJson(pagePath),\n    ])\n      .then(allData => {\n        const result = allData[1]\n        if (result.status === PageResourceStatus.Error) {\n          return {\n            status: PageResourceStatus.Error,\n          }\n        }\n\n        let pageData = result.payload\n        const { componentChunkName } = pageData\n        return this.loadComponent(componentChunkName).then(component => {\n          const finalResult = { createdAt: new Date() }\n          let pageResources\n          if (!component) {\n            finalResult.status = PageResourceStatus.Error\n          } else {\n            finalResult.status = PageResourceStatus.Success\n            if (result.notFound === true) {\n              finalResult.notFound = true\n            }\n            pageData = Object.assign(pageData, {\n              webpackCompilationHash: allData[0]\n                ? allData[0].webpackCompilationHash\n                : ``,\n            })\n            pageResources = toPageResources(pageData, component)\n            finalResult.payload = pageResources\n            emitter.emit(`onPostLoadPageResources`, {\n              page: pageResources,\n              pageResources,\n            })\n          }\n          this.pageDb.set(pagePath, finalResult)\n          // undefined if final result is an error\n          return pageResources\n        })\n      })\n      // prefer duplication with then + catch over .finally to prevent problems in ie11 + firefox\n      .then(response => {\n        this.inFlightDb.delete(pagePath)\n        return response\n      })\n      .catch(err => {\n        this.inFlightDb.delete(pagePath)\n        throw err\n      })\n\n    this.inFlightDb.set(pagePath, inFlight)\n    return inFlight\n  }\n\n  // returns undefined if loading page ran into errors\n  loadPageSync(rawPath) {\n    const pagePath = findPath(rawPath)\n    if (this.pageDb.has(pagePath)) {\n      return this.pageDb.get(pagePath).payload\n    }\n    return undefined\n  }\n\n  shouldPrefetch(pagePath) {\n    // Skip prefetching if we know user is on slow or constrained connection\n    if (!doesConnectionSupportPrefetch()) {\n      return false\n    }\n\n    // Check if the page exists.\n    if (this.pageDb.has(pagePath)) {\n      return false\n    }\n\n    return true\n  }\n\n  prefetch(pagePath) {\n    if (!this.shouldPrefetch(pagePath)) {\n      return false\n    }\n\n    // Tell plugins with custom prefetching logic that they should start\n    // prefetching this path.\n    if (!this.prefetchTriggered.has(pagePath)) {\n      this.apiRunner(`onPrefetchPathname`, { pathname: pagePath })\n      this.prefetchTriggered.add(pagePath)\n    }\n\n    // If a plugin has disabled core prefetching, stop now.\n    if (this.prefetchDisabled) {\n      return false\n    }\n\n    const realPath = findPath(pagePath)\n    // Todo make doPrefetch logic cacheable\n    // eslint-disable-next-line consistent-return\n    this.doPrefetch(realPath).then(() => {\n      if (!this.prefetchCompleted.has(pagePath)) {\n        this.apiRunner(`onPostPrefetchPathname`, { pathname: pagePath })\n        this.prefetchCompleted.add(pagePath)\n      }\n    })\n\n    return true\n  }\n\n  doPrefetch(pagePath) {\n    throw new Error(`doPrefetch not implemented`)\n  }\n\n  hovering(rawPath) {\n    this.loadPage(rawPath)\n  }\n\n  getResourceURLsForPathname(rawPath) {\n    const pagePath = findPath(rawPath)\n    const page = this.pageDataDb.get(pagePath)\n    if (page) {\n      const pageResources = toPageResources(page.payload)\n\n      return [\n        ...createComponentUrls(pageResources.page.componentChunkName),\n        createPageDataUrl(pagePath),\n      ]\n    } else {\n      return null\n    }\n  }\n\n  isPageNotFound(rawPath) {\n    const pagePath = findPath(rawPath)\n    const page = this.pageDb.get(pagePath)\n    return page && page.notFound === true\n  }\n\n  loadAppData(retries = 0) {\n    return doFetch(`${__PATH_PREFIX__}/page-data/app-data.json`).then(req => {\n      const { status, responseText } = req\n\n      let appData\n\n      if (status !== 200 && retries < 3) {\n        // Retry 3 times incase of non-200 responses\n        return this.loadAppData(retries + 1)\n      }\n\n      // Handle 200\n      if (status === 200) {\n        try {\n          const jsonPayload = JSON.parse(responseText)\n          if (jsonPayload.webpackCompilationHash === undefined) {\n            throw new Error(`not a valid app-data response`)\n          }\n\n          appData = jsonPayload\n        } catch (err) {\n          // continue regardless of error\n        }\n      }\n\n      return appData\n    })\n  }\n}\n\nconst createComponentUrls = componentChunkName =>\n  (window.___chunkMapping[componentChunkName] || []).map(\n    chunk => __PATH_PREFIX__ + chunk\n  )\n\nexport class ProdLoader extends BaseLoader {\n  constructor(asyncRequires, matchPaths) {\n    const loadComponent = chunkName =>\n      asyncRequires.components[chunkName]\n        ? asyncRequires.components[chunkName]()\n            .then(preferDefault)\n            // loader will handle the case when component is null\n            .catch(() => null)\n        : Promise.resolve()\n\n    super(loadComponent, matchPaths)\n  }\n\n  doPrefetch(pagePath) {\n    const pageDataUrl = createPageDataUrl(pagePath)\n    return prefetchHelper(pageDataUrl, {\n      crossOrigin: `anonymous`,\n      as: `fetch`,\n    })\n      .then(() =>\n        // This was just prefetched, so will return a response from\n        // the cache instead of making another request to the server\n        this.loadPageDataJson(pagePath)\n      )\n      .then(result => {\n        if (result.status !== PageResourceStatus.Success) {\n          return Promise.resolve()\n        }\n        const pageData = result.payload\n        const chunkName = pageData.componentChunkName\n        const componentUrls = createComponentUrls(chunkName)\n        return Promise.all(componentUrls.map(prefetchHelper)).then(\n          () => pageData\n        )\n      })\n  }\n\n  loadPageDataJson(rawPath) {\n    return super.loadPageDataJson(rawPath).then(data => {\n      if (data.notFound) {\n        // check if html file exist using HEAD request:\n        // if it does we should navigate to it instead of showing 404\n        return doFetch(rawPath, `HEAD`).then(req => {\n          if (req.status === 200) {\n            // page (.html file) actually exist (or we asked for 404 )\n            // returning page resources status as errored to trigger\n            // regular browser navigation to given page\n            return {\n              status: PageResourceStatus.Error,\n            }\n          }\n\n          // if HEAD request wasn't 200, return notFound result\n          // and show 404 page\n          return data\n        })\n      }\n      return data\n    })\n  }\n}\n\nlet instance\n\nexport const setLoader = _loader => {\n  instance = _loader\n}\n\nexport const publicLoader = {\n  // Deprecated methods. As far as we're aware, these are only used by\n  // core gatsby and the offline plugin, however there's a very small\n  // chance they're called by others.\n  getResourcesForPathname: rawPath => {\n    console.warn(\n      `Warning: getResourcesForPathname is deprecated. Use loadPage instead`\n    )\n    return instance.i.loadPage(rawPath)\n  },\n  getResourcesForPathnameSync: rawPath => {\n    console.warn(\n      `Warning: getResourcesForPathnameSync is deprecated. Use loadPageSync instead`\n    )\n    return instance.i.loadPageSync(rawPath)\n  },\n  enqueue: rawPath => instance.prefetch(rawPath),\n\n  // Real methods\n  getResourceURLsForPathname: rawPath =>\n    instance.getResourceURLsForPathname(rawPath),\n  loadPage: rawPath => instance.loadPage(rawPath),\n  loadPageSync: rawPath => instance.loadPageSync(rawPath),\n  prefetch: rawPath => instance.prefetch(rawPath),\n  isPageNotFound: rawPath => instance.isPageNotFound(rawPath),\n  hovering: rawPath => instance.hovering(rawPath),\n  loadAppData: () => instance.loadAppData(),\n}\n\nexport default publicLoader\n"]},"metadata":{},"sourceType":"module"}