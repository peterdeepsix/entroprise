{"ast":null,"code":"import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _inherits from\"@babel/runtime/helpers/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React from\"react\";import loader,{PageResourceStatus}from\"./loader\";import shallowCompare from\"shallow-compare\";var EnsureResources=function(_React$Component){_inherits(EnsureResources,_React$Component);function EnsureResources(props){var _this;_classCallCheck(this,EnsureResources);_this=_possibleConstructorReturn(this,_getPrototypeOf(EnsureResources).call(this));var location=props.location,pageResources=props.pageResources;_this.state={location:_objectSpread({},location),pageResources:pageResources||loader.loadPageSync(location.pathname)};return _this;}_createClass(EnsureResources,[{key:\"loadResources\",value:function loadResources(rawPath){var _this2=this;loader.loadPage(rawPath).then(function(pageResources){if(pageResources&&pageResources.status!==PageResourceStatus.Error){_this2.setState({location:_objectSpread({},window.location),pageResources:pageResources});}else{window.history.replaceState({},\"\",location.href);window.location=rawPath;}});}},{key:\"shouldComponentUpdate\",value:function shouldComponentUpdate(nextProps,nextState){if(!nextState.pageResources){this.loadResources(nextProps.location.pathname);return false;}if(this.state.pageResources!==nextState.pageResources){return true;}if(this.state.pageResources.component!==nextState.pageResources.component){return true;}if(this.state.pageResources.json!==nextState.pageResources.json){return true;}if(this.state.location.key!==nextState.location.key&&nextState.pageResources.page&&(nextState.pageResources.page.matchPath||nextState.pageResources.page.path)){return true;}return shallowCompare(this,nextProps,nextState);}},{key:\"render\",value:function render(){if(process.env.NODE_ENV!==\"production\"&&!this.state.pageResources){throw new Error(\"EnsureResources was not able to find resources for path: \\\"\"+this.props.location.pathname+\"\\\"\\nThis typically means that an issue occurred building components for that path.\\nRun `gatsby clean` to remove any cached elements.\");}return this.props.children(this.state);}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(_ref,prevState){var location=_ref.location;if(prevState.location.href!==location.href){var pageResources=loader.loadPageSync(location.pathname);return{pageResources:pageResources,location:_objectSpread({},location)};}return{location:_objectSpread({},location)};}}]);return EnsureResources;}(React.Component);export default EnsureResources;","map":{"version":3,"sources":["C:/Users/arnol/code/entroprise/.cache/ensure-resources.js"],"names":["React","loader","PageResourceStatus","shallowCompare","EnsureResources","props","location","pageResources","state","loadPageSync","pathname","rawPath","loadPage","then","status","Error","setState","window","history","replaceState","href","nextProps","nextState","loadResources","component","json","key","page","matchPath","path","process","env","NODE_ENV","children","prevState","Component"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport loader, { PageResourceStatus } from \"./loader\"\nimport shallowCompare from \"shallow-compare\"\n\nclass EnsureResources extends React.Component {\n  constructor(props) {\n    super()\n    const { location, pageResources } = props\n    this.state = {\n      location: { ...location },\n      pageResources: pageResources || loader.loadPageSync(location.pathname),\n    }\n  }\n\n  static getDerivedStateFromProps({ location }, prevState) {\n    if (prevState.location.href !== location.href) {\n      const pageResources = loader.loadPageSync(location.pathname)\n      return {\n        pageResources,\n        location: { ...location },\n      }\n    }\n\n    return {\n      location: { ...location },\n    }\n  }\n\n  loadResources(rawPath) {\n    loader.loadPage(rawPath).then(pageResources => {\n      if (pageResources && pageResources.status !== PageResourceStatus.Error) {\n        this.setState({\n          location: { ...window.location },\n          pageResources,\n        })\n      } else {\n        window.history.replaceState({}, ``, location.href)\n        window.location = rawPath\n      }\n    })\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    // Always return false if we're missing resources.\n    if (!nextState.pageResources) {\n      this.loadResources(nextProps.location.pathname)\n      return false\n    }\n\n    // Check if the component or json have changed.\n    if (this.state.pageResources !== nextState.pageResources) {\n      return true\n    }\n    if (\n      this.state.pageResources.component !== nextState.pageResources.component\n    ) {\n      return true\n    }\n\n    if (this.state.pageResources.json !== nextState.pageResources.json) {\n      return true\n    }\n    // Check if location has changed on a page using internal routing\n    // via matchPath configuration.\n    if (\n      this.state.location.key !== nextState.location.key &&\n      nextState.pageResources.page &&\n      (nextState.pageResources.page.matchPath ||\n        nextState.pageResources.page.path)\n    ) {\n      return true\n    }\n    return shallowCompare(this, nextProps, nextState)\n  }\n\n  render() {\n    if (process.env.NODE_ENV !== `production` && !this.state.pageResources) {\n      throw new Error(\n        `EnsureResources was not able to find resources for path: \"${this.props.location.pathname}\"\nThis typically means that an issue occurred building components for that path.\nRun \\`gatsby clean\\` to remove any cached elements.`\n      )\n    }\n\n    return this.props.children(this.state)\n  }\n}\n\nexport default EnsureResources\n"]},"metadata":{},"sourceType":"module"}