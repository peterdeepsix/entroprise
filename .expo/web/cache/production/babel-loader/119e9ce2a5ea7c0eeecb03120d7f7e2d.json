{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useState,useEffect,useRef}from\"react\";import{Typography}from\"@material-ui/core\";var Participant=function Participant(_ref){var participant=_ref.participant;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),videoTracks=_useState2[0],setVideoTracks=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),audioTracks=_useState4[0],setAudioTracks=_useState4[1];var videoRef=useRef();var audioRef=useRef();var trackpubsToTracks=function trackpubsToTracks(trackMap){return Array.from(trackMap.values()).map(function(publication){return publication.track;}).filter(function(track){return track!==null;});};useEffect(function(){setVideoTracks(trackpubsToTracks(participant.videoTracks));setAudioTracks(trackpubsToTracks(participant.audioTracks));var trackSubscribed=function trackSubscribed(track){if(track.kind===\"video\"){setVideoTracks(function(videoTracks){return[].concat(_toConsumableArray(videoTracks),[track]);});}else{setAudioTracks(function(audioTracks){return[].concat(_toConsumableArray(audioTracks),[track]);});}};var trackUnsubscribed=function trackUnsubscribed(track){if(track.kind===\"video\"){setVideoTracks(function(videoTracks){return videoTracks.filter(function(v){return v!==track;});});}else{setAudioTracks(function(audioTracks){return audioTracks.filter(function(a){return a!==track;});});}};participant.on(\"trackSubscribed\",trackSubscribed);participant.on(\"trackUnsubscribed\",trackUnsubscribed);return function(){setVideoTracks([]);setAudioTracks([]);participant.removeAllListeners();};},[participant]);useEffect(function(){var videoTrack=videoTracks[0];if(videoTrack){videoTrack.attach(videoRef.current);return function(){videoTrack.detach();};}},[videoTracks]);useEffect(function(){var audioTrack=audioTracks[0];if(audioTrack){audioTrack.attach(audioRef.current);return function(){audioTrack.detach();};}},[audioTracks]);return React.createElement(React.Fragment,null,React.createElement(Typography,null,participant.identity),React.createElement(\"video\",{width:\"100%\",ref:videoRef,autoPlay:true}),React.createElement(\"audio\",{ref:audioRef,autoPlay:true,muted:true}));};export default Participant;","map":{"version":3,"sources":["C:/Users/arnol/code/entroprise/src/components/ServicePage/Participant.js"],"names":["React","useState","useEffect","useRef","Typography","Participant","participant","videoTracks","setVideoTracks","audioTracks","setAudioTracks","videoRef","audioRef","trackpubsToTracks","trackMap","Array","from","values","map","publication","track","filter","trackSubscribed","kind","trackUnsubscribed","v","a","on","removeAllListeners","videoTrack","attach","current","detach","audioTrack","identity"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\"\r\n\r\nimport { Typography } from \"@material-ui/core\"\r\n\r\nconst Participant = ({ participant }) => {\r\n  const [videoTracks, setVideoTracks] = useState([])\r\n  const [audioTracks, setAudioTracks] = useState([])\r\n\r\n  const videoRef = useRef()\r\n  const audioRef = useRef()\r\n\r\n  const trackpubsToTracks = trackMap =>\r\n    Array.from(trackMap.values())\r\n      .map(publication => publication.track)\r\n      .filter(track => track !== null)\r\n\r\n  useEffect(() => {\r\n    setVideoTracks(trackpubsToTracks(participant.videoTracks))\r\n    setAudioTracks(trackpubsToTracks(participant.audioTracks))\r\n\r\n    const trackSubscribed = track => {\r\n      if (track.kind === \"video\") {\r\n        setVideoTracks(videoTracks => [...videoTracks, track])\r\n      } else {\r\n        setAudioTracks(audioTracks => [...audioTracks, track])\r\n      }\r\n    }\r\n\r\n    const trackUnsubscribed = track => {\r\n      if (track.kind === \"video\") {\r\n        setVideoTracks(videoTracks => videoTracks.filter(v => v !== track))\r\n      } else {\r\n        setAudioTracks(audioTracks => audioTracks.filter(a => a !== track))\r\n      }\r\n    }\r\n\r\n    participant.on(\"trackSubscribed\", trackSubscribed)\r\n    participant.on(\"trackUnsubscribed\", trackUnsubscribed)\r\n\r\n    return () => {\r\n      setVideoTracks([])\r\n      setAudioTracks([])\r\n      participant.removeAllListeners()\r\n    }\r\n  }, [participant])\r\n\r\n  useEffect(() => {\r\n    const videoTrack = videoTracks[0]\r\n    if (videoTrack) {\r\n      videoTrack.attach(videoRef.current)\r\n      return () => {\r\n        videoTrack.detach()\r\n      }\r\n    }\r\n  }, [videoTracks])\r\n\r\n  useEffect(() => {\r\n    const audioTrack = audioTracks[0]\r\n    if (audioTrack) {\r\n      audioTrack.attach(audioRef.current)\r\n      return () => {\r\n        audioTrack.detach()\r\n      }\r\n    }\r\n  }, [audioTracks])\r\n\r\n  return (\r\n    <>\r\n      <Typography>{participant.identity}</Typography>\r\n      <video width=\"100%\" ref={videoRef} autoPlay={true} />\r\n      <audio ref={audioRef} autoPlay={true} muted={true} />\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Participant\r\n"]},"metadata":{},"sourceType":"module"}